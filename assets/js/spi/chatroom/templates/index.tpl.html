<!-- template "index.tpl.html"-->
<!-- List of Supperted Cities   -->
<section class="row-fluid"   ng-controller="<%= 'Main_' + namespace + '_Controller' %> as main" ng-init="status={open:true}; currentChatRoom = null;"
          style="height: 100%; 
    "  > 
    <style>
        #chat_dialog .textMsg{
            border-radius: 1em;
            padding: 0.5em;
        }
/*        html,body{ height:100%}*/
    </style>

    <div class="row" style="height: 100%;"> 
        <article class="col-sm-4 affix"  style="height:100%"> 
            <accordion  id="list_client" style="height:70%">
                <accordion-group is-open="status.open">
                    <accordion-heading> 
                      Convensations
                        <i class="pull-right fa " ng-class="{'fa-chevron-down': status.open, 'fa-chevron-right': !status.open}"></i> 
                    </accordion-heading>

                    <ul class="list-group" id="clients_list">
                        <li ng-repeat="item in entitiesList track by $index" class="list-group-item"
                            ng-class="{'list-group-item-success':item.id == currentChatRoom.id}"
                            ng-click="onSetCurrentChatRoom(item); item.$isNewMsg = false;"  
                            >{{item.owner.username}}<span class="badge " ng-show="item.$isNewMsg && currentChatRoom.id != item.id">
                                <i class="fa fa-exclamation"></i>    </span>  
                            <!-- TODO: add {{item.updatedAt| date}} and time ago information-->
                        </li>  
                    </ul> 
                </accordion-group> 
            </accordion> 
            <accordion id="list_operator" style="height:30%">
                <accordion-group is-open="status.open2">
                    <accordion-heading> 
                      Operators online
                        <i class="pull-right fa " ng-class="{'fa-chevron-down': status.open2, 'fa-chevron-right': !status.open2}"></i> 
                    </accordion-heading>

                    <ul class="list-group" id="operator_list">
                        <li ng-repeat="item in entitiesList track by $index" class="list-group-item"
                            ng-class="{'list-group-item-success':item.id == currentChatRoom.id}"
                            ng-click="onSetCurrentChatRoom(item); item.$isNewMsg = false;"  
                            >{{item.owner.username}}<span class="badge " ng-show="item.$isNewMsg && currentChatRoom.id != item.id">
                                <i class="fa fa-exclamation"></i>    </span>  
                            <!-- TODO: add {{item.updatedAt| date}} and time ago information-->
                        </li>  
                    </ul> 
                </accordion-group> 
            </accordion> 
            
        </article>
        <article class="col-sm-offset-4 col-sm-8 overflowable" style="height: 100%;">
            <div class="col-sm-12" style="height: 100%; padding-bottom: 60px;">
                <h4 class="text text-left text-primary col-sm-12">Message Window 
                    <strong ng-show="currentChatRoom.owner.username">от {{currentChatRoom.owner.username}}  ({{currentChatRoom.owner.email}}) 
                        <button ng-click="onShowHistory(currentChatRoom.id)" class="btn btn-sm btn-info pull-right">История </button></strong>
                </h4>
                
                  <!--TODO: make it as directive -->
            <ul autoscroll-down class="list-group" id="chat_dialog" style="height:100%;overflow-y: auto;border: #0000ed solid;">
                <li ng-repeat="item in currentChatRoom.msgs" class="list-group-item" 
                    ng-class="{'text-right':item.owner == currentChatRoom.owner.id}">
                    <span class="textMsg" ng-class="{'list-group-item-warning':item.owner == currentChatRoom.owner.id}">
                        {{item.text}}
                        <!--<br/>   <span am-time-ago="item.updatedAt"></span>-->  
                    </span>
                </li>
            </ul> 
            </div>
          
         </article>
        <footer class="col-sm-offset-4 navbar-fixed-bottom"  ng-show="!!!currentChatRoom" > 
            <form class="form well-sm  col-sm-12" id="chatform" ng-submit="onSendMessage($event, currentChatRoom.id, messagesForUser)" > 
                <div class="form-group">
                  <div class="col-sm-10 col-lg-10">
                <textarea  ng-model="messagesForUser"
                           enter-submit="onSendMessage($event, currentChatRoom.id, messagesForUser)"
                           class="form-control col-sm-8" 
                           id="messageText"  ng-disabled="!currentChatRoom"  
                           placeholder="Type message here (Shift+Enter - new line)"
                           ></textarea>
                  </div> 
                       <div class="col-sm-2 col-lg-2">
                <input type="submit" id="submit" class="btn btn-success col-sm-12" ng-disabled="!messagesForUser || !currentChatRoom" value="Send"/>
                </div>
            </form>
        </footer>  
       
    </div> 
</section>
<!-- //template "index.tpl.html"-->